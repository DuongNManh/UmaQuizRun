name: Build and Release Zip

on:
  push:
    tags:
      - 'v*' # Chạy khi bạn push tag có định dạng v1.0, v2.1.3...

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Cần quyền này để tạo Release

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create Zip Archive
        run: |
          # Nén tất cả nhưng loại bỏ các file config không liên quan
          zip -r project-dist.zip . -x "*.git*" "Dockerfile" "docker-compose.yml" "nginx.conf" ".github/*" ".dockerignore"

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: project-dist.zip
          name: Release ${{ github.ref_name }}
          body: |
            Tự động đóng gói bản build cho phiên bản ${{ github.ref_name }}.
            Các file cấu hình Docker/Nginx đã được loại bỏ.
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}